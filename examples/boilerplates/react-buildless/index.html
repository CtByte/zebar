<html>
  <body>
    <div id="root"></div>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://ga.jspm.io/npm:es-module-shims@1.7.0/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react?dev",
          "react-dom/client": "https://esm.sh/react-dom/client?dev",
          "zebar": "https://esm.sh/zebar"
        }
      }
    </script>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect } from 'react';
      import { createRoot } from 'react-dom/client';
      import { init } from 'zebar';

      const zebarCtx = await init();
      const [cpu, battery, memory, weather] = await Promise.all([
        zebarCtx.createProvider({ type: 'cpu' }),
        zebarCtx.createProvider({ type: 'battery' }),
        zebarCtx.createProvider({ type: 'memory' }),
        zebarCtx.createProvider({ type: 'weather' }),
      ]);

      createRoot(document.getElementById('root')).render(<App />);

      function App() {
        const [outputs, setOutputs] = useState({
          cpu: cpu.output,
          battery: battery.output,
          memory: memory.output,
          weather: weather.output,
        });

        useEffect(() => {
          cpu.onOutput(cpu => setOutputs({ ...outputs, cpu }));
          battery.onOutput(battery => setOutputs({ ...outputs, battery }));
          memory.onOutput(memory => setOutputs({ ...outputs, memory }));
          weather.onOutput(weather => setOutputs({ ...outputs, weather }));
        }, []);

        return (
          <div>
            cpu: {outputs.cpu.usage}
            battery: {outputs.battery?.chargePercent}
            memory: {outputs.memory.usage}
            weather temp: {outputs.weather.celsiusTemp}
            weather status: {outputs.weather.status}
          </div>
        );
      }
    </script>
  </body>
</html>
